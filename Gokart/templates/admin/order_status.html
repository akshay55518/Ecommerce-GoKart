{% extends "app/base.html" %}
{% load static %}
{% block title %}Order Status{% endblock title %}

{% block main-content %}
<link rel="stylesheet" href="{% static 'app/css/admin-style.css' %}">
<div class="container py-5">
    <h2 class="text-center mb-5 display-6 fw-bold text-dark">Order Management</h2>

    {% for i in order %}
    <div class="card shadow-sm mb-4 rounded-4 border-0">
        <div class="card-header d-flex justify-content-between bg-primary text-white rounded-top-4">
            <h5 class="mb-0">User: {{ i.user.username|capfirst }}</h5>
            <p class="mb-0">Ordered Date: {{ i.ordered_date|date:"d M Y, H:i" }}</p>
        </div>
        <div class="card-body d-flex flex-wrap justify-content-between gap-4">
            <!-- Product Image -->
            <div class="flex-shrink-0">
                {% if i.product.product_image %}
                    <img src="{{ i.product.product_image.url }}" alt="{{ i.product.title }}" class="rounded shadow-sm" style="width:120px; height:150px; object-fit:cover;">
                {% else %}
                    <img src="{% static 'images/default-banner.jpg' %}" alt="Default Image" class="rounded shadow-sm" style="width:120px; height:150px; object-fit:cover;">
                {% endif %}
            </div>

            <!-- Product & Customer Details -->
            <div class="flex-grow-1">
                <table class="table table-borderless mb-0">
                    <tbody>
                        <tr>
                            <th>Product:</th>
                            <td>{{ i.product.title }}</td>
                        </tr>
                        <tr>
                            <th>Quantity:</th>
                            <td>{{ i.quantity }}</td>
                        </tr>
                        <tr>
                            <th>Address:</th>
                            <td>{{ i.customer.name }}, {{ i.customer.address }}, {{ i.customer.city }}, {{ i.customer.state }}, {{ i.customer.zipcode }}</td>
                        </tr>
                        <tr>
                            <th>Mobile:</th>
                            <td>{{ i.customer.mobile }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Order Status Update -->
            <div class="flex-shrink-0">
                <h5 class="mb-3">Order Status: 
                    <span class="badge 
                        {% if i.status == 'Delivered' %}bg-success
                        {% elif i.status == 'Rejected' %}bg-danger
                        {% elif i.status == 'On the Way' %}bg-warning text-dark
                        {% else %}bg-info text-dark{% endif %}">
                        {{ i.status }}
                    </span>
                </h5>

                {% if i.status != 'Rejected' and i.status != 'Delivered' %}
                <form method="post" action="{% url 'update_order_status' i.id %}">
                    {% csrf_token %}
                    <label for="status" class="form-label fw-semibold">Update Status:</label>
                    <select id="status" name="status" class="form-select mb-3">
                        <option value="" disabled selected>Select Status</option>
                        <option value="Accepted">Accepted</option>
                        <option value="Packed">Packed</option>
                        <option value="Pending">Pending</option>
                        <option value="On the Way">On the Way</option>
                        <option value="Delivered">Delivered</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                    <button type="submit" class="btn btn-success w-100">Update</button>
                </form>
                {% endif %}
            </div>
        </div>

        <div class="card-footer d-flex justify-content-end bg-light rounded-bottom-4">
            <h5 class="mb-0">Total Cost: <span class="fw-bold text-primary">${{ i.total_cost }}</span></h5>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-muted mt-5">No orders found.</p>
    {% endfor %}
</div>

{% endblock main-content %}
